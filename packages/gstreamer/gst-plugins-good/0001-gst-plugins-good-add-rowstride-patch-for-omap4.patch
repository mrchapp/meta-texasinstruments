From 1bde98e0b4fba1a91f3eeef66ceb9e6bee42b8af Mon Sep 17 00:00:00 2001
From: Rob Clark <rob@ti.com>
Date: Tue, 10 Nov 2009 20:50:33 -0600
Subject: [PATCH] gst-plugins-good: add rowstride patch for omap4


Signed-off-by: Rob Clark <rob@ti.com>
---
 .../gstreamer/gst-plugins-good/rowstride.patch     |   26 ++++++++++++++++++++
 packages/gstreamer/gst-plugins-good_git.bb         |    5 ++-
 2 files changed, 29 insertions(+), 2 deletions(-)
 create mode 100644 packages/gstreamer/gst-plugins-good/rowstride.patch

diff --git a/packages/gstreamer/gst-plugins-good/rowstride.patch b/packages/gstreamer/gst-plugins-good/rowstride.patch
new file mode 100644
index 0000000..7029619
--- /dev/null
+++ b/packages/gstreamer/gst-plugins-good/rowstride.patch
@@ -0,0 +1,26 @@
+diff --git a/sys/v4l2/gstv4l2object.c b/sys/v4l2/gstv4l2object.c
+index 144e025..3512ada 100644
+--- a/sys/v4l2/gstv4l2object.c
++++ b/sys/v4l2/gstv4l2object.c
+@@ -1097,8 +1097,10 @@ gst_v4l2_object_v4l2fourcc_to_structure (guint32 fourcc)
+           g_assert_not_reached ();
+           break;
+       }
+-      structure = gst_structure_new ("video/x-raw-yuv",
+-          "format", GST_TYPE_FOURCC, fcc, NULL);
++      structure = gst_structure_new ("video/x-raw-yuv-strided",
++          "format", GST_TYPE_FOURCC, fcc,
++          "rowstride", G_TYPE_INT, 4096,
++          NULL);
+       break;
+     }
+     case V4L2_PIX_FMT_DV:
+@@ -1219,7 +1221,7 @@ gst_v4l2_object_get_caps_info (GstV4l2Object * v4l2object, GstCaps * caps,
+   *fps_n = gst_value_get_fraction_numerator (framerate);
+   *fps_d = gst_value_get_fraction_denominator (framerate);
+ 
+-  if (!strcmp (mimetype, "video/x-raw-yuv")) {
++  if (!strcmp (mimetype, "video/x-raw-yuv-strided")) {
+     gst_structure_get_fourcc (structure, "format", &fourcc);
+ 
+     switch (fourcc) {
diff --git a/packages/gstreamer/gst-plugins-good_git.bb b/packages/gstreamer/gst-plugins-good_git.bb
index d432cec..b7daf97 100644
--- a/packages/gstreamer/gst-plugins-good_git.bb
+++ b/packages/gstreamer/gst-plugins-good_git.bb
@@ -1,17 +1,18 @@
 require gst-plugins-git.inc
 DEPENDS += "gst-plugins-base gconf cairo jpeg libpng gtk+ zlib libid3tag flac \
 	    speex"
-PR = "r4"
+PR = "r5"
 
 EXTRA_OECONF += "--disable-aalib --disable-esd --disable-shout2 --disable-libcaca --without-check \
 	--enable-gst_v4l2 --enable-xvideo --enable-experimental"
 
 PACKAGES += "gst-plugin-id3demux"
 
-SRCREV = "285cf0d19081b7fe69afc95bb5da6b365ed94a51"
+SRCREV = "cc47277e6587be79a3bb1111a457b04c01d37cd8"
 
 # override the SRC_URI from gst-plugins-git.inc to pull from our
 # fork (can be removed when v4l2sink is integrated upstream):
 SRC_URI = "git://gitorious.org/robclark-gstreamer/gst-plugins-good.git;protocol=git \
            file://common-20090928.tar.gz \
+           file://rowstride.patch;patch=1 \
           "
-- 
1.5.6.3

