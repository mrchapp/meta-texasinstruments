From e7f7d164b25d1e7710a323ef83cf3c6b551cc3ad Mon Sep 17 00:00:00 2001
From: Rob Clark <rob@ti.com>
Date: Thu, 3 Dec 2009 09:40:21 -0600
Subject: [PATCH 3/3] h264dec:  needs to copy width/height from input port to output port

---
 WTSD_DucatiMMSW/omx/omx_il_1_x/omx_h264_dec/src/omx_h264vd.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/WTSD_DucatiMMSW/omx/omx_il_1_x/omx_h264_dec/src/omx_h264vd.c b/WTSD_DucatiMMSW/omx/omx_il_1_x/omx_h264_dec/src/omx_h264vd.c
index 6d35231..3727927 100644
--- a/WTSD_DucatiMMSW/omx/omx_il_1_x/omx_h264_dec/src/omx_h264vd.c
+++ b/WTSD_DucatiMMSW/omx/omx_il_1_x/omx_h264_dec/src/omx_h264vd.c
@@ -787,6 +787,12 @@ static OMX_ERRORTYPE OMX_TI_H264VD_SetParameter(OMX_HANDLETYPE hComponent,
             else if (((OMX_PARAM_PORTDEFINITIONTYPE *)(pParamStruct))->nPortIndex == pH264vdComPvt->pPortdefs[OMX_H264VD_INPUT_PORT]->nPortIndex)
 	    {
                 TIMM_OSAL_Memcpy(pH264vdComPvt->pPortdefs[OMX_H264VD_INPUT_PORT], pParamStruct, sizeof (OMX_PARAM_PORTDEFINITIONTYPE));
+                /* copy width/height information to output port */
+                pH264vdComPvt->pPortdefs[OMX_H264VD_OUTPUT_PORT]->format.video.nFrameHeight =
+                		pH264vdComPvt->pPortdefs[OMX_H264VD_INPUT_PORT]->format.video.nFrameHeight;
+                pH264vdComPvt->pPortdefs[OMX_H264VD_OUTPUT_PORT]->format.video.nFrameWidth =
+                		pH264vdComPvt->pPortdefs[OMX_H264VD_INPUT_PORT]->format.video.nFrameWidth;
+                /* probably this should trigger re-calculation of output buffer size? */
             }
 
 
-- 
1.6.3.2

